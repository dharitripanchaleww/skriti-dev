let activeRow,addRowID,table;const URL_PATH=window.location.pathname;let filterOptions={search:""};function handleForm(e){e.on("form:submit",(function(){return console.log("prevent form submit"),!1})),e.on("field:success",(function(){const e=this.$element,t=e.attr("data-form-field-type");switch(console.log(e,t),t){case"dropdown":e.next().removeClass("invalid-item-border");break;case"image":e.parent().removeClass("invalid-item-border")}})),e.on("field:error",(function(){const e=this.$element,t=e.attr("data-form-field-type");switch(console.log("field error: ",e,t),t){case"dropdown":e.next().addClass("invalid-item-border");break;case"image":e.parent().addClass("invalid-item-border")}})),e.on("form:success",(function(e){const t=$(e.element),a=new FormData(t[0]);let n="";switch(t.attr("data-form-type")){case"add":n=`${URL_PATH}/add`;break;case"update":n=`${URL_PATH}/update`;break;case"status":n=`${URL_PATH}/update-status`;break;case"feature":n=`${URL_PATH}/update-featured`}t.find("button[type=submit]").attr("disabled",!0),$("#loader").css("display","block"),$.ajax({type:"POST",url:n,contentType:!1,processData:!1,data:a,success:successAlert,error:errorAlert})}))}function successAlert(e){$("#loader").hide(),$(".form-add-or-update").find("button[type=submit]").attr("disabled",!1);const t=e.message;if(console.log(`success: ${e}, ${t}`),Swal.fire({title:"Success!",text:t,type:"success"}),"delete"===e.type)table.row(activeRow).remove().draw(),$('button[class="close"]').click();else if("status"===e.type){const e=activeRow.find('[data-field-name="Status"]'),t=$("#Status-status").val();e.attr("data-value",t);const a=e.find("span");a.text(t),"Approved"===t||"Unblocked"===t||"Paid"===t?a.attr("class","table-status-update btn btn-success btn-rounded waves-effect waves-light"):"Pending"===t?a.attr("class","table-status-update btn btn-warning btn-rounded waves-effect waves-light"):"Rejected"!==t&&"Blocked"!==t||a.attr("class","table-status-update btn btn-danger btn-rounded waves-effect waves-light"),e.change(),$('button[class="close"]').click()}else setTimeout((()=>{location.reload()}),500)}function errorAlert(e,t,a){$("#loader").hide(),$(".form-add-or-update").find("button[type=submit]").attr("disabled",!1);const n=JSON.parse(e.responseText).message;Swal.fire({title:"Error",text:n,type:"error"})}function updateFormField(e,t){const a=e.attr("data-form-field-type");switch(a){case"id":case"email":case"text":case"textarea":case"number":e.val(t);break;case"dropdown":e.find("option").filter((function(){return $(this).val()==`${t}`})).prop("selected",!0).change();break;case"image":const n=e.attr("id"),r=e.attr("name");e.closest('div[class="form-group mb-3"]').html(`\n                <label for="${n}-update">${r}</label>\n                <input\n                    type="file"\n                    name="${r}"\n                    id="${n}-update"\n                    class="dropify"\n                    data-default-file="${t}"\n                    accept="image/*"\n                    data-max-file-size="15M"\n                    data-height="200px"\n                    data-show-remove="false"\n                    />\n                <p class="text-muted text-center mt-2 mb-0">${r}</p>\n            `);$(".dropify").dropify().on("dropify.beforeClear",(function(e,t){const a=$(t.element);$(a).attr("data-default-file","")}));break;case"date":flatpickr(e,{defaultDate:new Date(t),minDate:(new Date).fp_incr(1),allowInput:!0,altInput:!0,onOpen:function(e,t,a){$(a.altInput).prop("readonly",!0)},onClose:function(e,t,a){$(a.altInput).prop("readonly",!1),$(a.altInput).blur()}});break;case"date-range":const[s,o]=formlFieldValue.split(" To ");flatpickr(e,{mode:"range",altFormat:"j F Y",dateFormat:"j F Y",minDate:s,defaultDate:[s,o],allowInput:!0,altInput:!0,onOpen:function(e,t,a){$(a.altInput).prop("readonly",!0)},onClose:function(e,t,a){$(a.altInput).prop("readonly",!1),$(a.altInput).blur()}});break;default:console.warn("no form field found.",a,t)}}$(window).on("load",(function(){let e;window.Parsley.addValidator("filemaxmegabytes",{requirementType:"string",validateString:function(e,t,a){var n=a.$element[0].files,r=1048576*t;let s=0;return Array.from(n).forEach((e=>{s+=e.size})),s<=r},messages:{en:"Size can not be more than %sMB."}}).addValidator("filemimetypes",{requirementType:"string",validateString:function(e,t,a){var n=a.$element[0].files,r=t.replace(/\s/g,"").split(",");let s=[];return Array.from(n).forEach((e=>{s.push(-1!==r.indexOf(e.type))})),s.every((e=>e))},messages:{en:"Not supported file type."}}),$(".selectpicker").selectpicker(),$(".dropify").dropify({messages:{default:"Drag and drop a file here or click",replace:"Drag and drop or click to replace",remove:"Remove",error:"Not valid file, Please select a valid file"}}),table=$("#main-table").DataTable({pageLength:10,autoWidth:!1,processing:!0,serverSide:!0,scrollX:!0,order:[[0,"desc"]],ajax:$.fn.dataTable.pipeline({url:`${URL_PATH}/pagination`,pages:5,data:e=>{e.filter_options=filterOptions}}),columns,language:{processing:"Loading...",paginate:{previous:"<i class='mdi mdi-chevron-left'>",next:"<i class='mdi mdi-chevron-right'>"}},columnDefs:[{targets:"no_sort",orderable:!1},{"max-width":"20%",targets:"_all"}]}),$("#search-table").keyup((function(){clearTimeout(e),e=setTimeout((()=>{const e=this.value;filterOptions.search=e,table.search(e).draw()}),500)})),$("select.filter_by_dropdown").on("change",(function(){const e=$(this).val(),t=$(this).attr("name");filterOptions[t]=e,filterOptions.search=$("#search-table").val()||"",table.search(Math.random()).draw()})),$("#main-table").on("click",".table-delete-row",(function(){var e=$(this).parents("tr:first");const t={id:e.attr("id")};Swal.fire({title:"Are you sure?",text:"You won't be able to revert this!",type:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete it!",cancelButtonText:"No, cancel!",confirmButtonClass:"btn btn-success mt-2",cancelButtonClass:"btn btn-danger ml-2 mt-2",buttonsStyling:!1}).then((function(a){a.value?(activeRow=e,$("#loader").css("display","block"),$.ajax({type:"DELETE",url:`${URL_PATH}/delete`,data:t,dataType:"json",success:successAlert,error:errorAlert})):(a.dismiss,Swal.DismissReason.cancel)}))}));const t=$("form").parsley({triggerAfterFailure:"focusout changed.bs.select"});t&&(t.length?t.forEach((e=>handleForm(e))):handleForm(t)),$("#main-table").on("click",".table-update-row",(function(){$("#update-form").parsley().reset();const e=$("#update-form");const t=$(this).parents("tr:first").data();for(const a in t){const n=`#${a.split(" ").join("_").toLowerCase()}_update`;updateFormField(e.find(n),t[a])}})),$("#main-table").on("click",".table-status-update",(function(){var e=$(this).parents("tr:first");activeRow=e;const t=e.attr("id"),a=e.data().Status,n=$("#status-form"),r=$(n).find("#status_status option").filter((function(){return $(this).val()==`${a}`}));$(r).prop("selected",!0).change();$(n).find('input[name="id"]').prop("value",t)})),$("#main-table").on("click",'[data-target="#table-update-is-featured"]',(function(){var e=$(this).parents("tr:first");activeRow=e;const t=e.attr("id"),a=e.data()["Is Featured"],n=$("#feature-form"),r=$(n).find("#featured_status option").filter((function(){return $(this).val()==`${a}`}));$(r).prop("selected",!0).change();$(n).find('input[name="id"]').prop("value",t)})),$("form").on("focus","input[type=number]",(function(e){$(this).on("wheel.disableScroll",(function(e){e.preventDefault()}))})),$("form").on("blur","input[type=number]",(function(e){$(this).off("wheel.disableScroll")})),$("#add-btn").click((()=>{$('button[class="dropify-clear"]').click(),$(".invalid-item-border").removeClass("invalid-item-border"),$("#add-form").trigger("reset"),$("#add-form").parsley().reset(),$(".selectpicker").selectpicker("refresh")}))}));